# /traffic/road-close/original-intelligence-expr

* ExprConfig
``` apollo
{
    path: "horoscope.road_close.model"
}
```

* RoadCloseV3
``` restful
get http://10.1.1.2/road-close-v3/${link}
```

* RoadCloseV3r1
``` restful
get http://10.1.1.2/road-close-v3/${link}
```

* QuickfixStatus
``` restful
get http://10.1.1.3/quickfix/road-status/${link}
```
* PushIntelligence
``` restful
post http://10.1.1.1/new_intelligence
${intelligence}
```

***
    link <- @original_intelligence.entity
    quickfix_status <~ QuickfixStatus(entity=link)

    use_new_model <- ExprConfig()
    <> {
        ? use_new_model
        => {
            model_result <- RoadCloseV3r1(link=link)
        }

        ? use_old_model = true
        => {
            model_result <- RoadCloseV3(link=link)
        }
    }

    <> {
        ? is_normal = model_result.confidence < 0.9
        | is_already_closed = quickfix_status.catalog in ["close", "dthrough"]
        => {
            + "10 minutes" => /traffic/road-close/monitor#link
        }
        
        ? need_close = true 
        => {
            // return value will be saved to push_intelligence
            PushIntelligence(intelligence=@original_intelligence)
        }
    }
***
